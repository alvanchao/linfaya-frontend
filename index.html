<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linfaya Couture｜官方購物網站</title>
  <meta name="description" content="Linfaya Couture 提供練習服、男女裝、飾品、舞鞋等多元商品，舒適耐穿，快速到貨。" />
  <style>
    :root{ --bg:#0b0c10;--panel:#111319;--muted:#8a94a7;--pri:#5eead4;--pri-2:#2dd4bf;--text:#e6e9ef;--accent:#a78bfa;--danger:#ef4444 }
    *{box-sizing:border-box}
    body{margin:0;background:#0b0c10;color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans","PingFang TC","Hiragino Sans",sans-serif}
    header{position:sticky;top:0;background:#111319;padding:12px 20px;display:flex;justify-content:space-between;align-items:center;z-index:10}
    .brand b{font-size:18px}
    nav a{color:var(--pri);margin:0 10px;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    h2{margin:10px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .product{background:#0f1320;border:1px solid #1f2430;border-radius:12px;padding:12px;display:flex;flex-direction:column}
    .product img{width:100%;height:200px;object-fit:cover;border-radius:10px}
    .btn{background:var(--pri);border:none;border-radius:10px;padding:8px 12px;margin-top:8px;cursor:pointer}
    .drawer{position:fixed;right:0;top:0;width:380px;max-width:100%;height:100%;background:#0c1018;border-left:1px solid #1e2430;transform:translateX(110%);transition:.2s;z-index:50;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    footer{margin-top:40px;padding:20px;text-align:center;color:#888;border-top:1px solid #333}
  </style>
</head>
<body>
  <header>
    <div class="brand"><b>LINFAYA COUTURE</b></div>
    <nav>
      <a href="#tops">Tops</a>
      <a href="#bottoms">Bottoms</a>
      <a href="#accessories">Accessories</a>
      <a href="#shoes">Shoes</a>
      <a href="#cart" id="openCart">購物車 <span id="cartCount">0</span></a>
    </nav>
  </header>

  <main class="container">
    <section id="tops">
      <h2>Tops</h2>
      <div class="grid" id="topsGrid"></div>
    </section>
    <section id="bottoms">
      <h2>Bottoms</h2>
      <div class="grid" id="bottomsGrid"></div>
    </section>
    <section id="accessories">
      <h2>Accessories</h2>
      <div class="grid" id="accessoriesGrid"></div>
    </section>
    <section id="shoes">
      <h2>Shoes</h2>
      <div class="grid" id="shoesGrid"></div>
    </section>
  </main>

  <!-- 購物車抽屜 -->
  <aside class="drawer" id="drawer">
    <header style="padding:12px;display:flex;justify-content:space-between;align-items:center">
      <b>購物車</b>
      <button id="closeCart">關閉</button>
    </header>
    <div id="cartList" style="flex:1;overflow:auto;padding:12px"></div>
    <div style="padding:12px;border-top:1px solid #1f2430">
      <div>小計：<span id="subtotal">0</span></div>
      <div>運費：<span id="shipping">0</span></div>
      <div>總計：<b id="grand">0</b></div>
      <button id="checkout" class="btn" style="width:100%;margin-top:10px">前往綠界付款</button>
    </div>
  </aside>

  <footer>
    © <span id="year"></span> LINFAYA COUTURE · 客服：linfaya251@gmail.com
  </footer>

  <script>
    const API_BASE = 'https://linfaya-ecpay-backend.onrender.com';
    const FREE_SHIP_THRESHOLD = 1000;
    const ADMIN_EMAIL = 'linfaya251@gmail.com';

    // 商品清單
    const PRODUCTS = {
      tops: [
        {id:'top01',name:'無縫高彈背心',price:399,color:'黑/膚',size:'S/M/L',img:'Photo/無縫高彈背心.jpg'},
        {id:'top02',name:'鏤空美背短袖',price:429,color:'黑/粉',size:'S/M/L',img:'Photo/鏤空美背短袖.jpg'}
      ],
      bottoms: [
        {id:'btm01',name:'高腰緊身褲',price:499,color:'黑/深灰',size:'S/M/L/XL',img:'Photo/高腰緊身褲.jpg'},
        {id:'sk01',name:'魚尾練習裙',price:699,color:'黑',size:'S/M/L',img:'Photo/魚尾練習裙.jpg'}
      ],
      accessories: [
        {id:'acc01',name:'經典髮帶',price:199,color:'多色',size:'Free',img:'Photo/髮帶.jpg'}
      ],
      shoes: [
        {id:'sh01',name:'專業舞鞋',price:1299,color:'黑',size:'34–40',img:'Photo/舞鞋.jpg'}
      ]
    };

    const state={cart:JSON.parse(sessionStorage.getItem('cart')||'[]')};
    const fmt=n=>'NT$'+n.toLocaleString('zh-Hant-TW');

    function renderSection(id,items){
      const grid=document.getElementById(id);
      grid.innerHTML='';
      items.forEach(p=>{
        const el=document.createElement('div');
        el.className='product';
        el.innerHTML=`
          <img src="${p.img}" alt="${p.name}">
          <b>${p.name}</b><br>
          顏色：${p.color}<br>
          尺寸：${p.size}<br>
          <div>${fmt(p.price)}</div>
          <button class="btn">加入購物車</button>`;
        el.querySelector('button').onclick=()=>addToCart(p);
        grid.appendChild(el);
      });
    }
    renderSection('topsGrid',PRODUCTS.tops);
    renderSection('bottomsGrid',PRODUCTS.bottoms);
    renderSection('accessoriesGrid',PRODUCTS.accessories);
    renderSection('shoesGrid',PRODUCTS.shoes);

    function addToCart(p){
      const f=state.cart.find(i=>i.id===p.id);
      if(f)f.qty=(f.qty||1)+1; else state.cart.push({...p,qty:1});
      persist();renderCart();
    }
    function persist(){sessionStorage.setItem('cart',JSON.stringify(state.cart))}
    function subtotal(){return state.cart.reduce((s,i)=>s+i.price*(i.qty||1),0)}
    function calcShipping(){return subtotal()>=FREE_SHIP_THRESHOLD?0:80}

    function renderCart(){
      const list=document.getElementById('cartList');list.innerHTML='';
      if(!state.cart.length){list.innerHTML='<p>購物車是空的</p>';return}
      state.cart.forEach((it,idx)=>{
        const el=document.createElement('div');
        el.innerHTML=`${it.name} x${it.qty} - ${fmt(it.price*it.qty)} <button onclick="removeItem(${idx})">刪除</button>`;
        list.appendChild(el);
      });
      document.getElementById('subtotal').textContent=fmt(subtotal());
      document.getElementById('shipping').textContent=fmt(calcShipping());
      document.getElementById('grand').textContent=fmt(subtotal()+calcShipping());
      document.getElementById('cartCount').textContent=state.cart.reduce((s,i)=>s+(i.qty||1),0);
    }
    function removeItem(idx){state.cart.splice(idx,1);persist();renderCart()}

    document.getElementById('openCart').onclick=()=>document.getElementById('drawer').classList.add('open');
    document.getElementById('closeCart').onclick=()=>document.getElementById('drawer').classList.remove('open');

    // 模擬付款 → 呼叫後端
    document.getElementById('checkout').onclick=async()=>{
      if(!state.cart.length)return alert('購物車是空的');
      const orderId='LF'+Date.now();
      const order={orderId,items:state.cart,amount:subtotal()+calcShipping(),notify:{admin:ADMIN_EMAIL}};
      const newWin=window.open('about:blank','_blank');
      try{
        const res=await fetch(`${API_BASE}/api/ecpay/create`,{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(order)});
        const data=await res.json();
        newWin.location=data.paymentUrl||API_BASE+'/thankyou';
      }catch(e){newWin.close();alert('付款建立失敗')}
    }

    renderCart();
    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
</body>
</html>
